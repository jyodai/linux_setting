source $HOME/.common_shell_aliases

alias sed='gsed'
alias gitb='bash gitb'
alias gitt='TITLE=$(gh pr view --json title -q '.title') && echo $TITLE && echo $TITLE | pbcopy'

export PATH=$HOME/.nodebrew/current/bin:$PATH

# direnvをシェルコマンド実行時に自動で読み込む設定
eval "$(direnv hook zsh)"

# zoxide
eval "$(zoxide init zsh)"
eval "$(zoxide init zsh --cmd cd)"

########## ########## ########## ########## ##########
########## コマンド履歴に関する設定         ##########
########## ########## ########## ########## ##########

# his と入力することで history からfzfで選択して実行可能
his() {
  local cmd
  # 履歴からコマンドを選択
  cmd=$(history -n 1 | fzf --tac --no-sort --query="$*")

  if [[ -n "$cmd" ]]; then
    # 1. 改行コードを変数に代入（これで確実に「本物の改行」を保持します）
    local nl=$'\n'
    
    # 2. 文字列としての "\n" を、変数 nl（本物の改行）に置換
    # 履歴内の "\\n" のうち、後ろの "\n" 部分を実際の改行に変えることで、
    # 結果的に "バックスラッシュ + 改行" という元の形が復元されます
    cmd="${cmd//\\n/$nl}"

    # 3. 編集バッファに送り出す
    print -rnz -- "$cmd"
  fi
}

HISTFILE=~/.zsh_history
HISTSIZE=1000000   # メモリ上の保存件数を増やす
SAVEHIST=1000000   # ファイルへの保存件数を増やす

# 重複を記録しない、空白から始まるコマンドを記録しないなどの便利設定
setopt hist_ignore_dups     # 直前と同じコマンドは記録しない
setopt share_history        # 別のウィンドウで実行したコマンドも共有する
setopt append_history       # 上書きではなく追記する
